{% extends "base.html" %}

{% block title %}{{ _('Prijava') }}{% endblock %}

{% block content %}
<div class="card-style">
    <h2 class="text-center mb-4">{{ _('Prijava') }}</h2>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for msg in messages %}
          <div class="error-msg">{{ msg }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% if block %}
    <!-- Blokirana prijava -->
    <div class="alert alert-danger text-center" role="alert">
        {{ _("Prekoračili ste maksimalan broj pokušaja. Sačekajte:") }}
        <span id="timer">{{ remaining_seconds // 60 }}:{{ '%02d' % (remaining_seconds % 60) }}</span>
        {{ _("minuta") }}.
    </div>

    <!-- Progress bar -->
    <div class="progress mb-3" style="height: 20px;">
        <div id="progressBar" 
             class="progress-bar progress-bar-striped progress-bar-animated bg-warning" 
             role="progressbar" 
             style="width: 100%">
        </div>
    </div>
    {% endif %}

    {% if not block %}
    <form method="POST" action="{{ url_for('main.login') }}">
        <div class="mb-3">
            <input type="email" class="form-control" name="email" placeholder="{{ _('Email') }}" required>
        </div>
        <div class="mb-3">
            <input type="password" class="form-control" name="password" placeholder="{{ _('Lozinka') }}" required>
        </div>
        <div class="d-grid">
            <button type="submit" class="btn btn-custom">{{ _('Prijavi se') }}</button>
        </div>
        <p class="mt-3 text-center">
            <a href="{{ url_for('main.reset_password_request') }}" 
               class="btn btn-outline-warning">
               {{ _('Zaboravili ste lozinku?') }}
            </a>
        </p>
    </form>
    {% endif %}

    <p class="mt-3 text-center">
        {{ _('Nemate nalog?') }}
        <a href="{{ url_for('main.register') }}" class="btn btn-warning ms-2">
            {{ _('Registrujte se') }}
        </a>
    </p>
</div>

{% if block %}
<script>
let remaining = {{ remaining_seconds }};
const timerEl = document.getElementById('timer');
const progressBar = document.getElementById('progressBar');
const total = remaining;

function updateTimer() {
    if (remaining <= 0) {
        location.reload(); // osveži stranicu kada blokada istekne
    } else {
        let minutes = Math.floor(remaining / 60);
        let seconds = remaining % 60;
        timerEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        // update progress bar
        let percent = (remaining / total) * 100;
        progressBar.style.width = percent + "%";

        remaining--;
    }
}

setInterval(updateTimer, 1000);
</script>
{% endif %}

{% endblock %}
